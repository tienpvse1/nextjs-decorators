<h1 align="center">Welcome to nextjs-decorators 👋</h1>
<p>
  <a href="https://www.npmjs.com/package/nextjs-decorators" target="_blank">
    <img alt="Version" src="https://img.shields.io/npm/v/nextjs-decorators.svg">
  </a>
  <img src="https://img.shields.io/badge/node-%3E%3D10-blue.svg" />
  <a href="#" target="_blank">
    <img alt="License: MIT" src="https://img.shields.io/badge/License-MIT-yellow.svg" />
  </a>
  <a href="https://twitter.com/Tin38662979" target="_blank">
    <img alt="Twitter: Tin38662979" src="https://img.shields.io/twitter/follow/Tin38662979.svg?style=social" />
  </a>
</p>

> a simple and lightweight collection of decorators to create APIs in an elegant way in DI pattern

## Prerequisites

- node >=10

## Install

```sh
npm i nextjs-decorators
```

## Usage

Step 1: Define a controller with @Controller decorator

```ts
//  pages/api/hello.ts

import { Controller } from 'nextjs-decorators'

@Controller('api/hello') // <--this should match with the route's url generated by Next.js
class MyAwesomeController {

}
```

Step 2: Defined a route with @{Method} decorator

```ts
//  pages/api/hello.ts

import { Controller, Get, Post, Param, Body } from 'nextjs-decorators'

@Controller('api/hello')                    
class MyAwesomeController {

    @Get(':id')                               // <-- this will match with route GET api/hello/{id}
    findById(@Param('id')id:string){          // <-- get the param from url
      return someDatabaseClient.findById(id)  // <-- Promise will be automatically resolved
    }
  
    @Post('')                              // <-- this will match with route POST api/hello
    findById(@Body()body: BodyInterface){     // <-- get the body from request       
      return someDatabaseClient.create(body)  // <-- Promise will be automatically resolved
    }

}
```

Step 3: Register the controller

```ts
  //  pages/api/hello
  import { Controller, Get, Post, Param, Body, registerController } from 'nextjs-decorators'

  @Controller('api/hello')                    
  class MyAwesomeController {

      @Get(':id')                               
      findById(@Param('id')id:string){          
        return someDatabaseClient.findById(id)  
      }
  
      @Post('')                               
      findById(@Body()body: BodyInterface){    
        return someDatabaseClient.create(body)  
      }

  }

  export default registerController(MyAwesomeController)  //  <--- all routes will be registered  

```

Dependency Injection(DI)
```ts
  // page/api/service.ts
  export class MyService{

      sayHello(){
        return { message: "you are awesome" }
      }    

  }


  // page/api/hello.ts
  import { Get, Controller, AutoInject, registerController } from 'nextjs-decorators' 
  import { MyService } from './service.ts';

  @AutoInject()             // <-- automatically inject list of dependencies in constructor
  @Controller('/api/hello')
  class MyAwesomeController{

      constructor(private service: MyService){}

      @Get()
      getMessage(){
        return this.service.sayHello()
      }

  }

  export default registerController(MyAwesomeController)

```

## Middleware
Basic usage
```ts
// pages/api/hello.ts
import { UseMiddleware, Controller, Get, registerController } from 'nextjs-decorators'

@UseMiddleware((req, res) => {
  /** do something like logic stuffs */
  /** Middleware at class level will apply its logic to all route in class */
  console.log(`${new Date()} - IP: ${req.ip} URL: ${req.URL}`)
  })   
@Controller("api/hello")
class MyAwesomeController{

    @Get()
    @UseMiddleware(()=> {
      console.log("route middleware get executed")    
    })
    saySomethingObvious(){
      return { message: "you are awesome" }
    }
}

export default registerController(MyAwesomeController)
```
WARNING: return statement in middleware will return immediately to the client, for example

```ts
// pages/api/hello.ts
import { UseMiddleware, Controller, Get, registerController } from 'nextjs-decorators'

@Controller("api/hello")
class MyAwesomeController{

    @Get()
    @UseMiddleware(()=> {
      return { message: "return at middleware" }  // <-- this is the result which client will receive
    })
    saySomethingObvious(){
      return { message: "you are awesome" } // <-- in fact this will never get executed
    }
}

export default registerController(MyAwesomeController)
```

## Guard
Guard is pretty much like Middleware, how ever it accept return type of boolean, if falsy value is returned
it will throw an Unauthorize exception, and cannot access the desired route

```ts
// pages/api/hello.ts
import { UseGuard, Controller, Get, registerController, Request } from 'nextjs-decorators'
import { NextApiRequest } from 'next'

@UseGuard((req: Request)=> {
  const user = database.user.findOne({ id: req.query.id }) 
  req.user = user
  return user;// <- throw Unauthorize exception if user not found in database
})
@Controller("api/hello")
class MyAwesomeController{

    @Get()
    @UseGuard(()=> user.role !== 'admin' /** access the user from the request we've set above */)
    adminRoute(){
      return { message: "Hi admin" } 
    }
}

export default registerController(MyAwesomeController)
```

## Author

👤 **tienpvse(Phan Van Tien)**

- Twitter: [@Tin38662979](https://twitter.com/Tin38662979)
- Github: [@tienpvse1](https://github.com/tienpvse1)
- LinkedIn: [@tienpvse](https://linkedin.com/in/tienpvse)

## Show your support

Give a ⭐️ if this project helped you!


